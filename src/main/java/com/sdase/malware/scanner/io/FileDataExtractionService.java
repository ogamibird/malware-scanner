package com.sdase.malware.scanner.io;

import com.sdase.malware.scanner.exception.FileDataExtractionException;
import lombok.AllArgsConstructor;
import org.springframework.core.io.Resource;
import org.springframework.stereotype.Service;
import org.springframework.util.MimeType;

import java.util.List;

@Service
@AllArgsConstructor
public class FileDataExtractionService {

    private final List<FileDataExtractor> extractors;

    public String extractData(Resource resource, MimeType mimeType) {
        FileDataExtractor fileDataExtractor = extractors.stream()
                                                        .filter(e -> e.canHandleType(mimeType))
                                                        .findAny()
                                                        .orElseThrow(() -> new FileDataExtractionException("No extractor for file type %s found. Extraction not possible.".formatted(mimeType)));
        return fileDataExtractor.extract(resource);
    }
}
